## 简绍
项目中默认引入以下日志收集方式，可以根据自己的需要进行增删，详情见 `日志扩展` 模块

- 控制台输出
- log日志文件
- ELK收集
- `plumelog(lite模式)`
## 预定义配置文件

- logback-sensitive   敏感数据脱敏
- logback-console  控制台打印输出配置
- logback-log-file  传统日志文件格式
- logback-elk  elk配套日志收集，输出json，通过`filebeat` 写入ES，通过kibana进行管理
- logback-plumelog  配套`PlumeLog` 日志收集，`PlumeLog` 是个轻量级的日志收集和管理组件

使用演示
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <!--项目名称-->
    <property name="appname" value="bootx-platform"/>
    <!--日志位置-->
    <property name="logdir" value="logs"/>

    <!-- 导入 需要注意先后顺序 -->
    <include resource="cn/bootx/common/log/logback-sensitive.xml"/>
    <include resource="cn/bootx/common/log/logback-console.xml"/>
    <include resource="cn/bootx/common/log/logback-log-file.xml"/>
    <include resource="cn/bootx/common/log/logback-elk.xml"/>
    <include resource="cn/bootx/common/log/logback-plumelog.xml"/>

    <!-- 开发输出级别 -->
    <root level="INFO">
        <appender-ref ref="console"/>
        <appender-ref ref="fileInfoLog"/>
        <appender-ref ref="elk"/>
        <appender-ref ref="plumelog"/>
    </root>
</configuration>
```
## ELK
在项目中`_config/elk`目录里有对应的配置文件，包括ElasticSearch和Kibana的 docker-compose.yml，和filebeat收集日志相关的配置
filebeat启动脚本
```yaml
version: '3'
services:
  # 日志收集
  filebeat:
    image: docker.elastic.co/beats/filebeat:7.13.2
    restart: always
    volumes:
      # 挂载日志目录到容器中
      - /data/logs:/data/logs
    # 启动命令
    command: filebeat /usr/share/filebeat/filebeat.yml
```

filebeat输出到ES配置
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /data/logs/bootx-platform/*.json
# 输出到es
output.elasticsearch:
  hosts: localhost:9200
  # 索引名
  index: "bootx-platform-logs"
# 设置
setup:
# 自定义索引的话必须设置
  template:
    name: "filebeat"
    pattern: "filebeat-*"
  ilm.enabled: false

processors:
  - decode_json_fields:
      fields: ['message'] #要进行解析的字段
      target: "" #json内容解析到指定的字段，如果为空（“”），则解析到顶级结构下
  - drop_fields:
      fields: ["log","ecs","agent","input","@metadata","message"] #删除无用的字段
```

ES日志索引格式
```json
{
  "mappings": {
      "properties":{
        "@timestamp":{"type":"date"},
        "log_time":{"type":"date"},
        "severity":{"type":"keyword"},
        "service":{"type":"keyword"},
        "trace":{"type":"keyword"},
        "class":{"type":"keyword"},
        "rest":{"type":"text"},
        "stack_trace":{"type":"text"},
        "thread_name":{"type":"keyword"},
        "host":{
          "properties": {
            "name": {"type": "keyword"}
          }
        }
      }
  }
}
```
