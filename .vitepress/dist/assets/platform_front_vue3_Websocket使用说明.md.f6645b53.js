import{_ as n,c as s,o as a,a as e}from"./app.f857f1b0.js";const b='{"title":"Mixin\u4F7F\u7528","description":"","frontmatter":{},"headers":[{"level":2,"title":"useWebSocket\u4ECB\u7ECD","slug":"usewebsocket\u4ECB\u7ECD"},{"level":3,"title":"\u5F15\u7528","slug":"\u5F15\u7528"},{"level":3,"title":"\u5E38\u7528\u53C2\u6570","slug":"\u5E38\u7528\u53C2\u6570"},{"level":3,"title":"\u56DE\u8C03\u51FD\u6570","slug":"\u56DE\u8C03\u51FD\u6570"},{"level":2,"title":"\u7528\u6237\u5168\u5C40\u6D88\u606F\u901A\u77E5","slug":"\u7528\u6237\u5168\u5C40\u6D88\u606F\u901A\u77E5"},{"level":3,"title":"\u4F7F\u7528","slug":"\u4F7F\u7528"},{"level":3,"title":"\u65B9\u6CD5\u4ECB\u7ECD","slug":"\u65B9\u6CD5\u4ECB\u7ECD"},{"level":3,"title":"\u793A\u4F8B","slug":"\u793A\u4F8B"}],"relativePath":"platform/front/vue3/Websocket\u4F7F\u7528\u8BF4\u660E.md"}',t={},o=e(`<h1 id="mixin\u4F7F\u7528" tabindex="-1">Mixin\u4F7F\u7528 <a class="header-anchor" href="#mixin\u4F7F\u7528" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>\u57FA\u4E8E<code>vueuse</code>\u4E2D\u7684<code>useWebSocket</code>\u8FDB\u884C\u5F00\u53D1<a href="https://vueuse.org/core/useWebSocket" target="_blank" rel="noopener noreferrer">useWebSocket\u6587\u6863</a>\uFF0C \u540C\u65F6\u63D0\u4F9B\u9ED8\u8BA4\u7684\u5168\u5C40\u6D88\u606F\u901A\u77E5\u529F\u80FD\u5B9E\u73B0<code>UserGlobalWebSocker</code>\u3002</p></div><h2 id="usewebsocket\u4ECB\u7ECD" tabindex="-1">useWebSocket\u4ECB\u7ECD <a class="header-anchor" href="#usewebsocket\u4ECB\u7ECD" aria-hidden="true">#</a></h2><h3 id="\u5F15\u7528" tabindex="-1">\u5F15\u7528 <a class="header-anchor" href="#\u5F15\u7528" aria-hidden="true">#</a></h3><p>\u9879\u76EE\u4E2D\u9ED8\u8BA4\u5DF2\u7ECF\u5F15\u5165<code>vueuse</code>\u5E93\uFF0C\u901A\u8FC7\u4E0B\u8FF0\u65B9\u5F0F\u8FDB\u884C\u5F15\u5165</p><div class="language-javascript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useWebSocket <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vueuse/core&#39;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> data<span class="token punctuation">,</span> send<span class="token punctuation">,</span> open<span class="token punctuation">,</span> close <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useWebSocket</span><span class="token punctuation">(</span><span class="token string">&#39;ws://websocketurl&#39;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="\u5E38\u7528\u53C2\u6570" tabindex="-1">\u5E38\u7528\u53C2\u6570 <a class="header-anchor" href="#\u5E38\u7528\u53C2\u6570" aria-hidden="true">#</a></h3><ul><li>immediate \u81EA\u52A8\u8FDE\u63A5\uFF08\u9ED8\u8BA4\u542F\u7528\uFF09</li><li>autoClose \u81EA\u52A8\u5173\u95ED\u8FDE\u63A5\uFF08\u9ED8\u8BA4\u542F\u7528\uFF09</li><li>autoReconnect \u81EA\u52A8\u91CD\u65B0\u8FDE\u63A5\u9519\u8BEF\uFF08\u9ED8\u8BA4\u7981\u7528\uFF09</li><li>heartbeat \u6BCF\u4E2A\u7ED9\u5B9A\u65F6\u95F4\u53D1\u9001\u4E00\u6761\u5C0F\u6D88\u606F\uFF08\u5FC3\u8DF3\uFF09\u4EE5\u4FDD\u6301\u8FDE\u63A5\u5904\u4E8E\u6D3B\u52A8\u72B6\u6001\uFF08\u9ED8\u8BA4\u7981\u7528\uFF09</li></ul><h3 id="\u56DE\u8C03\u51FD\u6570" tabindex="-1">\u56DE\u8C03\u51FD\u6570 <a class="header-anchor" href="#\u56DE\u8C03\u51FD\u6570" aria-hidden="true">#</a></h3><ul><li>onConnected \u8FDE\u63A5\u6210\u529F\u56DE\u8C03</li><li>onDisconnected \u5173\u95ED\u8FDE\u63A5\u56DE\u8C03</li><li>onError \u9519\u8BEF\u56DE\u8C03</li><li>onMessage \u63A5\u6536\u5230\u6D88\u606F\u56DE\u8C03</li></ul><h2 id="\u7528\u6237\u5168\u5C40\u6D88\u606F\u901A\u77E5" tabindex="-1">\u7528\u6237\u5168\u5C40\u6D88\u606F\u901A\u77E5 <a class="header-anchor" href="#\u7528\u6237\u5168\u5C40\u6D88\u606F\u901A\u77E5" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>\u767B\u5F55\u7CFB\u7EDF\u540E\u4F1A\u81EA\u52A8\u5EFA\u7ACB\u4E00\u4E2A\u5F53\u524D\u7528\u6237\u7684<code>Websocket</code>\u8FDE\u63A5\uFF0C\u540E\u7AEF\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E2A\u8FDE\u63A5\u5C06\u4FE1\u606F\u4E3B\u52A8\u63A8\u9001\u7ED9\u6307\u5B9A\u7528\u6237\u7684\u524D\u7AEF\u4E0A\uFF0C\u524D\u7AEF\u7EC4\u4EF6\u53EF\u4EE5\u53EF\u4EE5\u6839\u636E\u914D\u7F6E\u76D1\u542C\u4E0D\u540C\u7684\u4FE1\u606F\u4E8B\u4EF6\uFF0C \u7C7B\u4F3C\u751F\u4EA7\u8005/\u8BA2\u9605\u8005\u6A21\u5F0F</p></div><h3 id="\u4F7F\u7528" tabindex="-1">\u4F7F\u7528 <a class="header-anchor" href="#\u4F7F\u7528" aria-hidden="true">#</a></h3><p>\u5BFC\u5165<code>WebsocketNotice</code>\u7EC4\u4EF6\uFF0C\u4F7F\u7528\u63D0\u4F9B\u7684\u65B9\u6CD5\u6765\u8BA2\u9605\u6307\u5B9A\u4E3B\u9898\u7684\u6D88\u606F\uFF0C\u548C\u89E3\u9664\u5BF9\u5E94\u4E3B\u9898\u7684\u8BA2\u9605\u3002</p><div class="language-javascript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> publishWsEvent<span class="token punctuation">,</span> listenerEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/logics/websocket/WebsocketNotice&#39;</span>
</code></pre></div><h3 id="\u65B9\u6CD5\u4ECB\u7ECD" tabindex="-1">\u65B9\u6CD5\u4ECB\u7ECD <a class="header-anchor" href="#\u65B9\u6CD5\u4ECB\u7ECD" aria-hidden="true">#</a></h3><ul><li>publishWsEvent \u53D1\u5E03\u4E8B\u4EF6 <ul><li>key \u670D\u52A1\u7AEFwebsocket\u4E8B\u4EF6\u901A\u77E5\u7C7B\u578B</li><li>data \u6D88\u606F\u5185\u5BB9</li></ul></li><li>listenerEvent <ul><li>key \u670D\u52A1\u7AEFwebsocket\u4E8B\u4EF6\u901A\u77E5\u7C7B\u578B\uFF0C\u89C1\u524D\u7AEF\u5DE5\u7A0B<code>WsListenerEnum</code>\u679A\u4E3E\u7C7B</li><li>callback \u56DE\u8C03\u5904\u7406\u65B9\u6CD5</li></ul></li><li>clearEventsByKey \u6E05\u9664\u6307\u5B9Akey\u6240\u5173\u8054\u7684\u4E8B\u4EF6\u76D1\u542C <ul><li>key \u670D\u52A1\u7AEFwebsocket\u4E8B\u4EF6\u901A\u77E5\u7C7B\u578B\uFF0C\u89C1\u524D\u7AEF\u5DE5\u7A0B<code>WsListenerEnum</code>\u679A\u4E3E\u7C7B</li></ul></li><li>clearEvent <ul><li>\u6E05\u9664\u6307\u5B9A\u4E8B\u4EF6\u7684\u76D1\u542C\uFF08\u4E00\u4E2Akey\u53EF\u4EE5\u5BF9\u5E94\u591A\u4E2A\u56DE\u8C03\u4E8B\u4EF6\uFF09</li></ul></li></ul><h3 id="\u793A\u4F8B" tabindex="-1">\u793A\u4F8B <a class="header-anchor" href="#\u793A\u4F8B" aria-hidden="true">#</a></h3><div class="language-javascript"><pre><code>  <span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> clearEvent<span class="token punctuation">,</span> listenerEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/logics/websocket/WebsocketNotice&#39;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> useMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/hooks/web/useMessage&#39;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> createMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u76D1\u542C\u5168\u5C40\u4E8B\u4EF6</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onGlobalMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    createMessage<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;\u63A5\u6536\u5230\u672C\u9875\u9762\u7684\u5168\u5C40\u6D88\u606F: &#39;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u76D1\u542C \u901A\u77E5\u6D88\u606F\u66F4\u65B0</span>
    <span class="token function">listenerEvent</span><span class="token punctuation">(</span><span class="token string">&#39;EVENT_TEST_WEBSOCKET&#39;</span><span class="token punctuation">,</span> onGlobalMessage<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u89E3\u9664\u76D1\u542C \u901A\u77E5\u6D88\u606F\u66F4\u65B0  </span>
    <span class="token function">clearEvent</span><span class="token punctuation">(</span><span class="token string">&#39;EVENT_TEST_WEBSOCKET&#39;</span><span class="token punctuation">,</span> onGlobalMessage<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>`,19),p=[o];function c(l,i,u,r,k,d){return a(),s("div",null,p)}var g=n(t,[["render",c]]);export{b as __pageData,g as default};
