import{_ as s,o as a,c as n,X as o}from"./chunks/framework.6909765d.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"platform/server/other/IP归属地.md","filePath":"platform/server/other/IP归属地.md"}'),p={name:"platform/server/other/IP归属地.md"},l=o(`<h2 id="ip归属地" tabindex="-1">IP归属地 <a class="header-anchor" href="#ip归属地">¶</a></h2><p>可以IP所在的国家、城市、ISP运营商等信息，基于<code>ip2region</code>进行实现，地址：<a href="https://gitee.com/lionsoul/ip2region" target="_blank" rel="noreferrer">ip2region项目地址</a></p><h2 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式">¶</a></h2><h3 id="ip2region-xdb" tabindex="-1">ip2region.xdb <a class="header-anchor" href="#ip2region-xdb">¶</a></h3><p>首先在ip2region中下载下来<code>ip2region.xdb</code>文件，然后放到合适的地方，然后在<code>bootx.starter.audit-log.ip2region.file-path</code>配置上对应xdb文件路径</p><h3 id="查询方式" tabindex="-1">查询方式 <a class="header-anchor" href="#查询方式">¶</a></h3><p>查询方式支持三种，分别是：</p><ul><li>file 完全基于文件的查询(不推荐)</li><li>vector_index 使用固定的 512KiB 的内存空间缓存 vector index 数据，减少一次 IO 磁盘操作，从而加速查询(内存严重不足时使用)</li><li>cache 我们也可以预先加载整个 ip2region.xdb 的数据到内存，然后基于这个数据创建查询对象来实现完全基于文件的查询，速度最快效率最高(推荐)</li></ul><h3 id="调用代码" tabindex="-1">调用代码 <a class="header-anchor" href="#调用代码">¶</a></h3><p>通过注入<code>IpToRegionService</code>服务类进行查询。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestController</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">IpToRegionService</span><span style="color:#A6ACCD;"> ipToRegionService</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Operation</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">summary</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ip地址查询</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">GetMapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/ipToRegion</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ResResult</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">IpRegion</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ipToRegion</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ip</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> Res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ipToRegionService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRegionByIp</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ip</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="参数配置" tabindex="-1">参数配置 <a class="header-anchor" href="#参数配置">¶</a></h2><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">bootx</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">starter</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">audit-log</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># ip归属地 </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">ip2region</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># 数据文件路径</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">file-path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\\data\\ip2region\\ip2region.xdb</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;"># 查询方式</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">search-type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span></span></code></pre></div><h2 id="ip2region文件地址" tabindex="-1">ip2region文件地址 <a class="header-anchor" href="#ip2region文件地址">¶</a></h2><p><a href="https://gitee.com/lionsoul/ip2region/blob/master/data/ip2region.xdb" target="_blank" rel="noreferrer">GITEE地址</a></p>`,15),e=[l];function t(r,c,i,y,D,F){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
