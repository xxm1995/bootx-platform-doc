import{_ as s,c as i,o as a,a8 as n}from"./chunks/framework.riYNsadV.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"platform/server/other/IP归属地.md","filePath":"platform/server/other/IP归属地.md","lastUpdated":1692538214000}'),e={name:"platform/server/other/IP归属地.md"},p=n(`<h2 id="ip归属地" tabindex="-1">IP归属地 <a class="header-anchor" href="#ip归属地">¶</a></h2><p>可以IP所在的国家、城市、ISP运营商等信息，基于<code>ip2region</code>进行实现，地址：<a href="https://gitee.com/lionsoul/ip2region" target="_blank" rel="noreferrer">ip2region项目地址</a></p><h2 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式">¶</a></h2><h3 id="ip2region-xdb" tabindex="-1">ip2region.xdb <a class="header-anchor" href="#ip2region-xdb">¶</a></h3><p>首先在ip2region中下载下来<code>ip2region.xdb</code>文件，然后放到合适的地方，然后在<code>bootx.starter.audit-log.ip2region.file-path</code>配置上对应xdb文件路径</p><h3 id="查询方式" tabindex="-1">查询方式 <a class="header-anchor" href="#查询方式">¶</a></h3><p>查询方式支持三种，分别是：</p><ul><li>file 完全基于文件的查询(不推荐)</li><li>vector_index 使用固定的 512KiB 的内存空间缓存 vector index 数据，减少一次 IO 磁盘操作，从而加速查询(内存严重不足时使用)</li><li>cache 我们也可以预先加载整个 ip2region.xdb 的数据到内存，然后基于这个数据创建查询对象来实现完全基于文件的查询，速度最快效率最高(推荐)</li></ul><h3 id="调用代码" tabindex="-1">调用代码 <a class="header-anchor" href="#调用代码">¶</a></h3><p>通过注入<code>IpToRegionService</code>服务类进行查询。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IpToRegionService ipToRegionService;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">summary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ip地址查询&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/ipToRegion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ResResult&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IpRegion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipToRegion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ipToRegionService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRegionByIp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ip));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="参数配置" tabindex="-1">参数配置 <a class="header-anchor" href="#参数配置">¶</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">bootx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  starter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    audit-log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # ip归属地 </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ip2region</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 数据文件路径</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        file-path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\data\\ip2region\\ip2region.xdb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 查询方式</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        search-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cache</span></span></code></pre></div><h2 id="ip2region文件地址" tabindex="-1">ip2region文件地址 <a class="header-anchor" href="#ip2region文件地址">¶</a></h2><p><a href="https://gitee.com/lionsoul/ip2region/blob/master/data/ip2region.xdb" target="_blank" rel="noreferrer">GITEE地址</a></p>`,15),h=[p];function t(l,k,r,d,o,E){return a(),i("div",null,h)}const y=s(e,[["render",t]]);export{c as __pageData,y as default};
