import{_ as s,c as i,o as a,a8 as n}from"./chunks/framework.riYNsadV.js";const y=JSON.parse('{"title":"查询构造器","description":"","frontmatter":{},"headers":[],"relativePath":"platform/server/common/查询构造器.md","filePath":"platform/server/common/查询构造器.md","lastUpdated":1709110845000}'),l={name:"platform/server/common/查询构造器.md"},h=n(`<h1 id="查询构造器" tabindex="-1">查询构造器 <a class="header-anchor" href="#查询构造器">¶</a></h1><h2 id="功能" tabindex="-1">功能 <a class="header-anchor" href="#功能">¶</a></h2><ul><li>提供生成复杂查询(支持多级嵌套)和普通查询(多个条件之间AND方式查询)<code>Wrapper</code>的工具类方法</li><li>支持前端通过配置一个<code>json</code>对象，生成超级查询器的查询条件，后端接收到参数后自动生成<code>Wrapper</code></li><li>复杂查询支持多级嵌套查询、and和or组合的查询</li><li>复杂查询支持字符串、数字、布尔、日期、时间、日期时间、列表等方式的查询字段类型</li><li>复杂查询支持大于、小于、不等于、模糊批量、是否为空、不为空等条件匹配方式</li><li>普通查询支持后端通过对象方式接收查询条件，然后根据配置的的注解进行<code>Wrapper</code>的生成</li><li>普通查询支持字段排序操作，只需要查询参数继承<code>QueryOrder</code>类即可</li></ul><h2 id="复杂查询" tabindex="-1">复杂查询 <a class="header-anchor" href="#复杂查询">¶</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>对应前端使用方法见 <a href="/platform/front/vue3/查询构造器组件.html">前端器构造器使用</a></p></div><p>在要进行查询的地方，使用<code>QueryParams</code>对象接收前台传来的查询参数，调用<code>QueryGenerator#generator((QueryParams)</code>根据参数生成MyBatis Plus需要的<code>QueryWrapper</code>， 可以继续追加需要的查询条件，然后放入查询语句进行查询。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 超级查询</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> supperPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageParam pageParam, QueryParams queryParams) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    QueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; wrapper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryGenerator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queryParams);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Page&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; mpPage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MpUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMpPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pageParam, Client.class);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mpPage,wrapper);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="简单查询" tabindex="-1">简单查询 <a class="header-anchor" href="#简单查询">¶</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>前端不需要做额外处理，继续以原有的方式进行传参即可，后端会依据对实体类或参数类上面的注解，通过<code>QueryGenerator</code>工具类对接收到的参数进行转换即可</p></div><h3 id="queryparam注解" tabindex="-1">@QueryParam注解 <a class="header-anchor" href="#queryparam注解">¶</a></h3><blockquote><p>这个注解可以标注在查询参数类或者数据库实体类上，标注的生效优先级为 <code>QueryParams</code> 查询参数字段 &gt; <code>Entity</code> 数据库实体字段 &gt; <code>QueryParams</code> 查询类 &gt; <code>Entity</code> 数据库实体类</p></blockquote><p>参数说明：</p><ul><li><code>type</code> 查询匹配条件的类型，默认为<code>EQ</code>等于，类型说明见<code>CompareTypeEnum</code></li><li><code>ignore</code> 是否忽略该字段，忽略该字段后将不再参数查询条件的生成，通常用在类上已有标注，但个别字段需要进行排除的情况下</li><li><code>namingCase</code> 名称转换类型, 默认为<code>UNDER_LINE</code>下划线方式转换，在数据库实体类上使用时，可以使用<code>LAMBDA</code>方式，它将会读取Mybatis Plus中此字段配置的数据库名称，类型说明见 <code>NamingCaseEnum</code></li><li><code>fieldName</code> 自定义查询字段对应的数据库字段名称. 只可以在字段上标注时使用，标注在类上不生效，配置后，<code>namingCase</code>配置将会无效</li></ul><p>CompareTypeEnum（查询匹配类型）：</p><ul><li><code>GT</code> 大于</li><li><code>GE</code> 大于等于</li><li><code>LT</code> 小于</li><li><code>LE</code> 小于等于</li><li><code>EQ</code> 等于</li><li><code>LIKE</code> 模糊匹配</li><li><code>LIKE_LEFT</code> 左模糊</li><li><code>LIKE_RIGHT</code> 右模糊</li><li><code>IS_NULL</code> 是否为空, 只作用在布尔类型字段上, true 代表 is null, false 代表 not is null</li></ul><p><code>NamingCaseEnum</code>（名称转换类型）：</p><ul><li><code>LAMBDA</code> 获取数据库实体类配置的数据库字段名称，只可以用在数据库实体类字段上</li><li><code>UNDER_LINE</code> 转换为下划线格式</li><li><code>NONE</code> 不进行处理</li></ul><h3 id="查询排序" tabindex="-1">查询排序 <a class="header-anchor" href="#查询排序">¶</a></h3><blockquote><p>如果想支持字段排序，可以让继承<code>QueryOrder</code>类，然后传输对数的数据就可以支持字段排序。</p></blockquote><h3 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例">¶</a></h3><p><strong>查询实体类</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 支付订单查询参数, 支持字段排序</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">author</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xxm</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">since</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EqualsAndHashCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">callSuper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueryParam</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Accessors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;支付订单查询参数&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PayOrderQuery</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QueryOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /** 关联的业务号 */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueryParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryParam.CompareTypeEnum.LIKE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;关联的业务号&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String businessNo;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /** 标题 */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueryParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryParam.CompareTypeEnum.LIKE)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;标题&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String title;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>查询服务类</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Repository</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PayOrderManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PayOrderMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PayOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 分页</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Page&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PayOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageParam </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, PayOrderQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Page&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PayOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; mpPage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MpUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMpPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pageParam, PayOrder.class);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        QueryWrapper&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PayOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; generator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryGenerator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mpPage, generator);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,24),e=[h];function p(k,t,r,d,E,g){return a(),i("div",null,e)}const o=s(l,[["render",p]]);export{y as __pageData,o as default};
