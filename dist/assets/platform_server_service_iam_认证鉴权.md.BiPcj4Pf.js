import{_ as s,c as i,o as a,a8 as e}from"./chunks/framework.riYNsadV.js";const g=JSON.parse('{"title":"认证鉴权","description":"","frontmatter":{},"headers":[],"relativePath":"platform/server/service/iam/认证鉴权.md","filePath":"platform/server/service/iam/认证鉴权.md","lastUpdated":1692627846000}'),n={name:"platform/server/service/iam/认证鉴权.md"},h=e(`<h1 id="认证鉴权" tabindex="-1">认证鉴权 <a class="header-anchor" href="#认证鉴权">¶</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>基于功能服务中的<code>登录鉴权starter</code>进行实现，同时将连带介绍一下<code>登录鉴权</code>模块的详细使用方式。 其中认证和鉴权是两个概念，认证是用户登录成功后，用户信息会存储到<code>Redis</code>中，而鉴权则是用户登录成功后，会根据用户角色权限进行权限的校验， 如果用户没有权限则无法进行访问，对应到安全上就是进行垂直方向的安全控制。鉴权相关的说明单独放到了<a href="./访问权限管理.html">访问权限管理</a>模块中。</p></div><h2 id="登录认证" tabindex="-1">登录认证 <a class="header-anchor" href="#登录认证">¶</a></h2><h2 id="扩展或修改登录方式" tabindex="-1">扩展或修改登录方式 <a class="header-anchor" href="#扩展或修改登录方式">¶</a></h2><h3 id="默认的账号密码登录实现" tabindex="-1">默认的账号密码登录实现 <a class="header-anchor" href="#默认的账号密码登录实现">¶</a></h3><p>通过实现 <code>UsernamePasswordAuthentication</code> 接口并注入到Spring容器中即可，见IAM模块中的<code>PasswordLoginHandler</code>实现， 是否验证码以及验证码有效时间具体在实现类自己进行手动实现。</p><h3 id="第三方登录实现" tabindex="-1">第三方登录实现 <a class="header-anchor" href="#第三方登录实现">¶</a></h3><p>通过实现 <code>OpenIdAuthentication</code> 接口并注入到Spring容器中即可，见IAM模块中的<code>PhoneLoginHandler</code>和<code>WeChatLoginHandler</code>等实现</p><h3 id="其他登录实现" tabindex="-1">其他登录实现 <a class="header-anchor" href="#其他登录实现">¶</a></h3><p>通过实现鉴权抽象接口<code>AbstractAuthentication</code>进行编写</p><h3 id="调用登录" tabindex="-1">调用登录 <a class="header-anchor" href="#调用登录">¶</a></h3><p><code>TokenEndpoint</code> 接收登录相关请求，通过分发到具体登录实现类进行登录，登录成功后保存<code>Token</code>到<code>Redis</code>中</p><h2 id="访问鉴权" tabindex="-1">访问鉴权 <a class="header-anchor" href="#访问鉴权">¶</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>目前对请求接口进行控制的主要分为三类：第一种是无需登录就可以访问，第二种是登陆后可以访问，第三种是用户必须有相对应的权限才可以访问。请求后台接口时， 多种配置中任一方式认证通过后，就可以进行请求。</p></div><h3 id="不需要登录可访问" tabindex="-1">不需要登录可访问 <a class="header-anchor" href="#不需要登录可访问">¶</a></h3><p>通过在请求接口方法上标注<code>@IgnoreAuth</code>注解并设置<code>ignore</code>为<code>true</code>，或着在配置文件中的<code>bootx.starter.auth.ignoreUrls</code>项进行配置相关路径</p><h3 id="登陆后可访问" tabindex="-1">登陆后可访问 <a class="header-anchor" href="#登陆后可访问">¶</a></h3><p>通过在请求接口方法上标注<code>@IgnoreAuth</code>注解并设置<code>login</code>为<code>true</code>，且<code>ignore</code>为<code>false</code>。</p><h3 id="权限控制" tabindex="-1">权限控制 <a class="header-anchor" href="#权限控制">¶</a></h3><p>主要分为两种：通过Web管理端配置角色与接口的关联关系，或是通过在请求方法上标注<code>@PermCode</code>注解，系统会根据当前用户拥有角色所对应的权限码进行匹配， 如果配置有多个权限码，任一匹配通过即可访问。</p><h3 id="权限码控制样例" tabindex="-1">权限码控制样例 <a class="header-anchor" href="#权限码控制样例">¶</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;角色菜单权限关系&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/role/menu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RoleMenuController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RolePermService rolePermService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PermCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">summary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;根据角色id获取关联权限id集合(包含资源和菜单)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/findPermissionIdsByRole&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ResResult&lt;List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findPermissionIdsByRole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">roleId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">clientCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rolePermService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findPermissionIdsByRole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(roleId,clientCode));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,22),t=[h];function l(p,d,k,r,o,c){return a(),i("div",null,t)}const y=s(n,[["render",l]]);export{g as __pageData,y as default};
