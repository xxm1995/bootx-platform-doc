import{_ as s,o as a,c as l,X as n}from"./chunks/framework.6909765d.js";const F=JSON.parse('{"title":"超级查询器","description":"","frontmatter":{},"headers":[],"relativePath":"platform/server/common/超级查询器.md","filePath":"platform/server/common/超级查询器.md"}'),o={name:"platform/server/common/超级查询器.md"},p=n(`<h1 id="超级查询器" tabindex="-1">超级查询器 <a class="header-anchor" href="#超级查询器">¶</a></h1><h2 id="功能" tabindex="-1">功能 <a class="header-anchor" href="#功能">¶</a></h2><ul><li>提供生成复杂查询(支持多级嵌套)和普通查询(多个条件之间AND方式查询)<code>Wrapper</code>的工具类方法</li><li>支持前端通过配置一个<code>json</code>对象，生成超级查询器的查询条件，后端接收到参数后自动生成<code>Wrapper</code></li><li>复杂查询支持多级嵌套查询、and和or组合的查询</li><li>复杂查询支持字符串、数字、布尔、日期、时间、日期时间、列表等方式的查询字段类型</li><li>复杂查询支持大于、小于、不等于、模糊批量、是否为空、不为空等条件匹配方式</li><li>普通查询支持后端通过对象方式接收查询条件，然后根据配置的的注解进行<code>Wrapper</code>的生成</li></ul><h2 id="复杂查询" tabindex="-1">复杂查询 <a class="header-anchor" href="#复杂查询">¶</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>对应前端使用方法见 <a href="/platform/front/vue3/超级查询器.html">查询器组件使用</a></p></div><p>在要进行查询的地方，使用<code>QueryParams</code>对象接收前台传来的查询参数，调用<code>QueryGenerator#generator((QueryParams)</code>根据参数生成MyBatis Plus需要的<code>QueryWrapper</code>， 可以继续追加需要的查询条件，然后放入查询语句进行查询。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 超级查询</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Page</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Client</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">supperPage</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">PageParam</span><span style="color:#A6ACCD;"> pageParam</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">QueryParams</span><span style="color:#A6ACCD;"> queryParams</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">QueryWrapper</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Client</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> wrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> QueryGenerator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generator</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">queryParams</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">Page</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Client</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> mpPage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MpUtil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMpPage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pageParam</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Client</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">page</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mpPage</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="简单查询" tabindex="-1">简单查询 <a class="header-anchor" href="#简单查询">¶</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>前端不需要做额外处理，继续以原有的方式进行传参即可，后端会依据对实体类或参数类上面的注解，通过<code>QueryGenerator</code>工具类对接收到的参数进行转换即可</p></div><h3 id="queryparam注解" tabindex="-1">@QueryParam注解 <a class="header-anchor" href="#queryparam注解">¶</a></h3><blockquote><p>这个注解可以标注在查询参数类或者数据库实体类上，标注的生效优先级为 <code>QueryParams</code> 查询参数字段 &gt; <code>Entity</code> 数据库实体字段 &gt; <code>QueryParams</code> 查询类 &gt; <code>Entity</code> 数据库实体类</p></blockquote><p>参数说明：</p><ul><li><code>type</code> 查询匹配条件的类型，默认为<code>EQ</code>等于，类型说明见<code>CompareTypeEnum</code></li><li><code>ignore</code> 是否忽略该字段，忽略该字段后将不再参数查询条件的生成，通常用在类上已有标注，但个别字段需要进行排除的情况下</li><li><code>namingCase</code> 名称转换类型, 默认为<code>UNDER_LINE</code>下划线方式转换，在数据库实体类上使用时，可以使用<code>LAMBDA</code>方式，它将会读取Mybatis Plus中此字段配置的数据库名称，类型说明见 <code>NamingCaseEnum</code></li><li><code>fieldName</code> 自定义查询字段对应的数据库字段名称. 只可以在字段上标注时使用，标注在类上不生效，配置后，<code>namingCase</code>配置将会无效</li></ul><p>CompareTypeEnum（查询匹配类型）：</p><ul><li><code>GT</code> 大于</li><li><code>GE</code> 大于等于</li><li><code>LT</code> 小于</li><li><code>LE</code> 小于等于</li><li><code>EQ</code> 等于</li><li><code>LIKE</code> 模糊匹配</li><li><code>LIKE_LEFT</code> 左模糊</li><li><code>LIKE_RIGHT</code> 右模糊</li><li><code>IS_NULL</code> 是否为空, 只作用在布尔类型字段上, true 代表 is null, false 代表 not is null</li></ul><p>NamingCaseEnum（名称转换类型）：</p><ul><li><code>LAMBDA</code> 获取数据库实体类配置的数据库字段名称，只可以用在数据库实体类字段上</li><li><code>UNDER_LINE</code> 转换为下划线格式</li><li><code>NONE</code> 不进行处理</li></ul><h3 id="querygenerator方法类" tabindex="-1">QueryGenerator方法类 <a class="header-anchor" href="#querygenerator方法类">¶</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">QueryGenerator</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 根据查询对象数据和该类上标注的注解进行生成, 生成的多个查询条件之间用And连接</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">queryParams</span><span style="color:#676E95;font-style:italic;"> 参数对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">&lt;T&gt;</span><span style="color:#676E95;font-style:italic;"> 泛型</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@return</span><span style="color:#676E95;font-style:italic;"> 查询器</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">QueryWrapper</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generator</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">queryParams</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 根据查询对象数据，以及参数对象类和数据库Entity类上标注的注解进行生成, 生成的多个查询条件之间用And连接</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">queryParams</span><span style="color:#676E95;font-style:italic;"> 参数对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">clazz</span><span style="color:#676E95;font-style:italic;"> 数据库Entity类</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">&lt;T&gt;</span><span style="color:#676E95;font-style:italic;"> 泛型</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@return</span><span style="color:#676E95;font-style:italic;"> 查询器</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">QueryWrapper</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generator</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">queryParams</span><span style="color:#89DDFF;">,</span><span style="color:#C792EA;">Class</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">clazz</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例">¶</a></h3><p><strong>实体类</strong></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@author</span><span style="color:#676E95;font-style:italic;"> xxm</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@since</span><span style="color:#676E95;font-style:italic;"> 2020/12/8</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Data</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">QueryParam</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> QueryParam</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CompareTypeEnum</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LIKE</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Accessors</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">chain</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Schema</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">title</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">钱包查询参数</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WalletQueryParam</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Schema</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">description</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">钱包ID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> walletId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Schema</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">description</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">用户ID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> userId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Schema</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">description</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">商户编码</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> mchCode</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Schema</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">description</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">商户应用编码</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> mchAppCode</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>查询服务类</strong></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Repository</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">RequiredArgsConstructor</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WalletManager</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BaseManager</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">WalletMapper</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Wallet</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 查询钱包</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">walletQueryParam</span><span style="color:#676E95;font-style:italic;"> 钱包查询参数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#F78C6C;font-style:italic;">@return</span><span style="color:#676E95;font-style:italic;"> 钱包列表</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Wallet</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">queryWallet</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WalletQueryParam</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">walletQueryParam</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">QueryWrapper</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Wallet</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> queryWrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> QueryGenerator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generator</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">walletQueryParam</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">queryWrapper</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span></code></pre></div>`,24),e=[p];function t(c,r,y,i,D,C){return a(),l("div",null,e)}const d=s(o,[["render",t]]);export{F as __pageData,d as default};
